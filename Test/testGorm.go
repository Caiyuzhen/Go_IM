package main

import (
	"time"
	"ginchat/models"
	"gorm.io/driver/mysql"
	"gorm.io/gorm"
	"fmt"
)

// ã€æµ‹è¯•ã€‘ç”¨æˆ·æ•°æ®çš„ Model  =>  Schema
type UserBasic struct {
	gorm.Model // ç»§æ‰¿ gorm.Model, ç»§æ‰¿åå¯ä»¥ä½¿ç”¨ gorm.Model çš„å±æ€§
	Identity string // å”¯ä¸€æ ‡è¯†
	Name string // ç”¨æˆ·å
	Password string // å¯†ç 
	Phone string // æ‰‹æœºå·
	Email string // é‚®ç®±
	ClientIp string // å®¢æˆ·ç«¯ IP => è®¾å¤‡
	ClientPort string // å®¢æˆ·ç«¯ç«¯å£ => è®¾å¤‡
	LoginTime *time.Time // ç™»å½•æ—¶é—´(ä½¿ç”¨æŒ‡é’ˆç±»å‹, è®©é»˜è®¤å€¼ä¸ºç©º), uint64 æ˜¯æ—¶é—´æˆ³, ä½¿ç”¨ time.Time å¯ä»¥é¿å…ä¸ºç©ºæ—¶é»˜è®¤æ—¶é—´ä¸º 0 çš„çŠ¶æ€
	HeartBeatTime *time.Time // å¿ƒè·³æ—¶é—´(ä½¿ç”¨æŒ‡é’ˆç±»å‹, è®©é»˜è®¤å€¼ä¸ºç©º),, uint64 æ˜¯æ—¶é—´æˆ³,  ä½¿ç”¨ time.Time å¯ä»¥é¿å…ä¸ºç©ºæ—¶é»˜è®¤æ—¶é—´ä¸º 0 çš„çŠ¶æ€
	LogoutTime *time.Time  // ç™»å‡ºæ—¶é—´(ä½¿ç”¨æŒ‡é’ˆç±»å‹, è®©é»˜è®¤å€¼ä¸ºç©º),, uint64 æ˜¯æ—¶é—´æˆ³,  ä½¿ç”¨ time.Time å¯ä»¥é¿å…ä¸ºç©ºæ—¶é»˜è®¤æ—¶é—´ä¸º 0 çš„çŠ¶æ€  || `` ä¸ºè¡¨è¾¾å¼, è‡ªå®šä¹‰åœ¨æ•°æ®åº“å†…çš„å­—æ®µå `gorm:"column:logOut_time" json:"logOut_time`
	IsLogOut bool // æ˜¯å¦ç™»å‡º
	DeviceInfo string // è®¾å¤‡ä¿¡æ¯
}


func main() {
	// è¿æ¥æ•°æ®åº“ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	// ğŸ‘‡ åç»­å°è£…åˆ° utils å†…å»è¿æ¥æ•°æ®åº“
	db, err := gorm.Open(mysql.Open("root:123456@tcp(127.0.0.1:3306)/ginChat?charset=utf8mb4&parseTime=True&loc=UTC"), &gorm.Config{})
	if err != nil {
		panic("failed to connect database")
	}


	// å¦‚æœæ²¡æœ‰è¡¨, åˆ™åˆ›å»ºä¸€å¼ è¡¨  =>  schema
	db.AutoMigrate(&models.UserBasic{}) // 


	// æ–°å¢ä¸€ä¸ªç”¨æˆ· user â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	currentTime := time.Now() // ä½¿ç”¨ time.Now() è·å–å½“å‰æ—¶é—´
	user := &models.UserBasic{
		Name: "Jimmy",
		LoginTime: &currentTime, 
		HeartBeatTime: nil, // é»˜è®¤ä¸ºç©º
		LogoutTime: nil, // é»˜è®¤ä¸ºç©º
	}
	// user.Name = "Zeno"
	db.Create(user)



	// è¯»å–ç”¨æˆ· user  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	db.First(user, 1) // æ ¹æ®æ•´å‹ä¸»é”®æŸ¥æ‰¾ => è®¾ç½® id ä¸º 1 çš„ user
	fmt.Println(db.First(user, 1))
	// db.First(user, "code = ?", "D42") // æŸ¥æ‰¾ code å­—æ®µå€¼ä¸º D42 çš„è®°å½•



	// ä¿®æ”¹ç”¨æˆ· user (æ›´æ–°) â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	db.Model(user).Update("Password", 1234)


	// // Update - æ›´æ–°å¤šä¸ªå­—æ®µ
	// db.Model(&product).Updates(Product{Price: 200, Code: "F42"}) // ä»…æ›´æ–°éé›¶å€¼å­—æ®µ
	// db.Model(&product).Updates(map[string]interface{}{"Price": 200, "Code": "F42"})



	// Delete - åˆ é™¤ç”¨æˆ· user  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	// db.Delete(user, 1) // ğŸ”¥ åˆ«ä¸€æ–°å»ºå°±åˆ é™¤äº† !
}